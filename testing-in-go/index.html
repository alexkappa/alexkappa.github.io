<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v8.5.0 <https://hydejack.com/>
--><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><title>Testing in Go | alex kalyvitis</title><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Testing in Go" /><meta name="author" content="Alex Kalyvitis" /><meta property="og:locale" content="en" /><meta name="description" content="I’ve been hearing a lot of positive feedback about Google’s new programming language for some time now. Interfaces, simplicity, concurrency are some of the things you will definitely hear being praised as you get involved with the community." /><meta property="og:description" content="I’ve been hearing a lot of positive feedback about Google’s new programming language for some time now. Interfaces, simplicity, concurrency are some of the things you will definitely hear being praised as you get involved with the community." /><link rel="canonical" href="https://alexkappa.com/testing-in-go/" /><meta property="og:url" content="https://alexkappa.com/testing-in-go/" /><meta property="og:site_name" content="alex kalyvitis" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2014-10-31T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Testing in Go" /><meta name="twitter:site" content="@alexkalyvitis" /><meta name="twitter:creator" content="@Alex Kalyvitis" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Alex Kalyvitis"},"dateModified":"2014-10-31T00:00:00+00:00","datePublished":"2014-10-31T00:00:00+00:00","description":"I’ve been hearing a lot of positive feedback about Google’s new programming language for some time now. Interfaces, simplicity, concurrency are some of the things you will definitely hear being praised as you get involved with the community.","headline":"Testing in Go","mainEntityOfPage":{"@type":"WebPage","@id":"https://alexkappa.com/testing-in-go/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://alexkappa.com/assets/icons/icon.png"},"name":"Alex Kalyvitis"},"url":"https://alexkappa.com/testing-in-go/"}</script><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="alex kalyvitis"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="application-name" content="alex kalyvitis"><meta name="msapplication-config" content="/assets/ieconfig.xml"><meta name="theme-color" content="rgb(41,41,43)"><meta name="generator" content="Hydejack v8.5.0" /><link type="application/atom+xml" rel="alternate" href="https://alexkappa.com/feed.xml" title="alex kalyvitis" /><link rel="alternate" href="https://alexkappa.com/testing-in-go/" hreflang="en"><link rel="shortcut icon" href="/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/assets/icons/icon.png"><link rel="manifest" href="/assets/manifest.json"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="dns-prefetch" href="/" id="_baseURL"><link rel="dns-prefetch" href="/assets/js/hydejack-legacy-8.5.0.js" id="_hrefJS"><link rel="dns-prefetch" href="/sw.js" id="_hrefSW"><link rel="dns-prefetch" href="/assets/bower_components/fontfaceobserver/fontfaceobserver.standalone.js" id="_hrefFFO"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.js" id="_hrefKatexJS"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css" id="_hrefKatexCSS"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/contrib/copy-tex.min.js" id="_hrefKatexCopyJS"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/contrib/copy-tex.min.css" id="_hrefKatexCopyCSS"><link rel="dns-prefetch" href="/assets/img/swipe.svg" id="_hrefSwipeSVG"> <script> !function(e,t){"use strict";function n(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}e.loadJS=function(e,r){var o=t.createElement("script");o.src=e,r&&n(o,"load",r,{once:!0});var a=t.scripts[0];return a.parentNode.insertBefore(o,a),o},e._loaded=!1,e.loadJSDeferred=function(r,o){function a(){e._loaded=!0,o&&n(d,"load",o,{once:!0});var r=t.scripts[0];r.parentNode.insertBefore(d,r)}var d=t.createElement("script");return d.src=r,e._loaded?a():n(e,"load",a,{once:!0}),d},e.setRel=e.setRelStylesheet=function(e){function n(){this.rel="stylesheet"}var r=t.getElementById(e);r.addEventListener?r.addEventListener("load",n,{once:!0}):r.onload=n}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w, d) { w._noPushState = false; w._noDrawer = false; }(window, document); </script> <!--[if gt IE 8]><!----><link rel="stylesheet" href="/assets/css/hydejack-8.5.0.css"><link rel="stylesheet" href="/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata:500;700|Noto+Sans:300,300i,700,700i&display=swap"> <!--<![endif]--><body class="no-color-transition"><div id="_navbar" class="navbar fixed-top"><div class="content"><div class="nav-btn-bar"> <span class="sr-only">Jump to:</span> <a id="_menu" class="nav-btn no-hover fl" href="#_navigation"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a></div></div></div><hr class="sr-only" hidden /> <hy-push-state replace-ids="_main" link-selector="a[href]:not([href*='/assets/']):not(.external):not(.no-push-state)" duration="250" script-selector="script:not([type^='math/tex'])" prefetch ><main id="_main" class="content fade-in layout-post" role="main" data-color="rgb(217,218,220)" data-theme-color="rgb(41,41,43)" data-image="/assets/img/daniel-j-schwarz-XmC9mBSCPzM-unsplash.jpg" data-overlay ><article id="post-testing-in-go" class="page post mb6" role="article"><header><h1 class="post-title"> Testing in Go</h1><p class="post-date heading"> <time datetime="2014-10-31T00:00:00+00:00">31 Oct 2014</time> in <a href="/go/" class="flip-title">Go</a><div class="hr pb0"></div></header><p class="lead">I’ve been hearing a lot of positive feedback about Google’s new programming language for some time now. Interfaces, simplicity, concurrency are some of the things you will definitely hear being praised as you get involved with the community.<p>However my favourite thing about the language is something that isn’t your typical praising point. Testing is often one of those things you know you need, but keep neglecting because it isn’t easy and it’s value is not immediatelly clear from a business perspective.<p>During my short career in making software, I found that people really struggle when it comes to testing their code. I struggled myself when faced with the intricacies of testing object oriented code. The concept of test stubs and mocks was something that is challenging to most newcomers.<p>Testing in Go is remarkably powerful and it promotes high quality testable code by making it extremely easy to write tests. Now I’m not going to go through the elementary <code class="language-plaintext highlighter-rouge">hello</code> and <code class="language-plaintext highlighter-rouge">test_hello</code> introduction, rather start off with something that probably most Go developers have worked on at least once. An http handler.<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="s">"net/http"</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/foo"</span><span class="p">,</span> <span class="n">handleFoo</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">handleFoo</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"bar"</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div><p>This handler listens for HTTP calls to <code class="language-plaintext highlighter-rouge">/foo</code> and responds with <code class="language-plaintext highlighter-rouge">"bar"</code>. Specifically <code class="language-plaintext highlighter-rouge">"bar"</code> is written to <code class="language-plaintext highlighter-rouge">w</code> which is an <code class="language-plaintext highlighter-rouge">http.ResponseWriter</code>. In order to verify what has been written to the response we need to examine <code class="language-plaintext highlighter-rouge">w</code> after the call to <code class="language-plaintext highlighter-rouge">handleFoo</code>.<p>The <code class="language-plaintext highlighter-rouge">http.ResponseWriter</code> is an interface and is defined as:<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">ResponseWriter</span> <span class="k">interface</span> <span class="p">{</span>
	<span class="n">Header</span><span class="p">()</span> <span class="n">Header</span>
	<span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span><span class="p">)</span>
	<span class="n">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
	<span class="n">WriteHeader</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><p>We could easliy create our own implementation of ResponseWriter to use with our tests, but happily the standard library already has the handy <code class="language-plaintext highlighter-rouge">ResponseRecorder</code> in the <code class="language-plaintext highlighter-rouge">net/http/httptest</code> package.<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"testing"</span>
	<span class="s">"net/http"</span>
	<span class="s">"net/http/httptest"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">TestHandleFoo</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">r</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">http</span><span class="o">.</span><span class="n">NewRequest</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
	<span class="n">w</span> <span class="o">:=</span> <span class="n">httptest</span><span class="o">.</span><span class="n">NewRecorder</span><span class="p">()</span>

    <span class="n">handleFoo</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">String</span><span class="p">()</span> <span class="o">!=</span> <span class="s">"bar"</span> <span class="p">{</span>
    	<span class="n">t</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"expected %q but instead got %q"</span><span class="p">,</span> <span class="s">"bar"</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Of course this example is hardly complex and it doesn’t have any dependencies. Typically an HTTP handler would read/write something from a database, log something to a file, or render a template. In that case, we would probably prefer to implement an <code class="language-plaintext highlighter-rouge">http.Handler</code> instead of an <code class="language-plaintext highlighter-rouge">http.HandlerFunc</code> which is what <code class="language-plaintext highlighter-rouge">handleFoo</code> is, so we can define these dependencies.<p>I’ll describe a way to define these dependencies in an upcoming post.<p>Thanks for reading!</article><hr class="dingbat related" /><aside class="about related mt4 mb4" role="complementary"><div class="author mt4"> <hy-img src="/assets/img/me.jpg" class="avatar" alt="Alex Kalyvitis" srcset="/assets/img/me.jpg 1x,/assets/img/me.jpg 2x" root-margin="512px" > <noscript><img data-ignore src="/assets/img/me.jpg" class="avatar" alt="Alex Kalyvitis" srcset="/assets/img/me.jpg 1x,/assets/img/me.jpg 2x" /></noscript> <span class="loading" slot="loading" hidden> <span class="icon-cog"></span> </span> </hy-img><h2 class="page-title hr"> About</h2><p>Software Engineer. Leader. Made in 🇨🇾. Fine-tuned in 🇳🇱.<div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://github.com/alexkappa" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="https://www.linkedin.com/in/alex-kalyvitis" title="LinkedIn" class="no-mark-external"> <span class="icon-linkedin2"></span> <span class="sr-only">LinkedIn</span> </a><li> <a href="https://medium.com/@alexkappa" title="Medium" class="no-mark-external"> <span class="icon-medium"></span> <span class="sr-only">Medium</span> </a></ul></div></div></aside><aside class="related mb4" role="complementary"><h2 class="hr">Related Posts</h2><ul class="related-posts"><li> <a href="/json-polymorphism-in-go/" class="h4 flip-title"><span>JSON polymorphism in Go</span></a> <time class="heading faded fine" datetime="2020-03-15T00:00:00+00:00">15 Mar 2020</time><li> <a href="/go-trie/" class="h4 flip-title"><span>Trie</span></a> <time class="heading faded fine" datetime="2015-01-03T00:00:00+00:00">03 Jan 2015</time><li> <a href="/fun-with-tree-structures-and-go-interfaces/" class="h4 flip-title"><span>Fun with binary expression trees and Go</span></a> <time class="heading faded fine" datetime="2014-04-16T00:00:00+00:00">16 Apr 2014</time></ul></aside><footer role="contentinfo"><hr/><p><small class="copyright">© 2020 Alex Kalyvitis. All rights reserved. <br /> Cover photo by <a href="https://unsplash.com/@danieljschwarz">Daniel J. Schwarz</a> on <a href="https://unsplash.com/">Unsplash</a> </small><p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">8.5.0</span></small><hr class="sr-only"/></footer></main><hy-drawer class="" align="left" threshold="10" touch-events prevent-default ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(41,41,43);background-image:url(/assets/img/daniel-j-schwarz-XmC9mBSCPzM-unsplash.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="no-hover" href="/" tabindex="-1"> <img src="/assets/icons/icon.png" class="avatar" alt="alex kalyvitis" data-ignore /> </a><h2 class="h1"><a href="/">alex kalyvitis</a></h2><p class=""> Director of Software Engineering at Blueground</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_navigation" href="/" class="sidebar-nav-item active" > Home </a><li> <a href="/about/" class="sidebar-nav-item" > About </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://twitter.com/<username>" title="Twitter" class="no-mark-external"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/<username>" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if gt IE 10]><!----> <script type="module">window.__ESM__=!0; import '/assets/js/hydejack-8.5.0.js';</script> <script nomodule>if (!window.__ESM__) loadJSDeferred(document.getElementById('_hrefJS').href);</script> <script>!function(w, d) { w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; /**/ ga('create', 'UA-15737971-1', 'auto'); /**/ var pushStateEl = d.getElementsByTagName('hy-push-state')[0]; var timeoutId; pushStateEl.addEventListener('hy-push-state-load', function() { w.clearTimeout(timeoutId); timeoutId = w.setTimeout(function() { ga('set', 'page', w.location.pathname); ga('send', 'pageview'); }, 500); }); d.addEventListener('hy--cookies-ok', function () { w.ga(function(tracker) { w.ga("set", "anonymizeIp", undefined); localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId")); }); }); w.loadJSDeferred('https://www.google-analytics.com/analytics.js'); }(window, document);</script> <!--<![endif]--> <script> let textBox = document.querySelector(".sidebar-about > h2 > a"); let textBoxText = textBox.innerHTML; let altText = [textBoxText, "alexkappa"]; let altTextIndex = 0; let interval = 2000; let intervalId = window.setInterval(changeText, interval); window.setTimeout(() => { window.clearInterval(intervalId); }, (2 * interval) + 10); function fadeOut() { textBox.style.opacity = 0; } function fadeIn() { textBox.style.opacity = 1; } function changeInnerHtml() { altTextIndex = ++altTextIndex % altText.length; textBox.innerHTML = altText[altTextIndex]; } function changeText() { fadeOut(); window.setTimeout(() => { changeInnerHtml(); fadeIn(); }, 500); } </script><h2 class="sr-only" hidden>Templates (for web app):</h2><template id="_animation-template" hidden><div class="animation-main fixed-top"><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template" hidden><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template" hidden><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_forward-template" hidden> <button id="_forward" class="forward nav-btn no-hover fl"> <span class="sr-only">Forward</span> <span class="icon-arrow-right2"></span> </button> </template> <template id="_back-template" hidden> <button id="_back" class="back nav-btn no-hover fl"> <span class="sr-only">Back</span> <span class="icon-arrow-left2"></span> </button> </template> <template id="_permalink-template" hidden> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="icon-link"></span> </a> </template></html>
